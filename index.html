<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Meal Prep Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Cormorant+Garamond:wght@400;500;600&display=swap" rel="stylesheet" />

<style>

/* ---------------------------------------------------
   GLOBAL + NOTION OPTIMIZATION
--------------------------------------------------- */

html, body {
  margin: 0;
  padding: 0;
  background: transparent !important; /* Notion embed removes background */
  font-family: 'Inter', sans-serif;
  overflow-x: hidden !important;
}

.dashboard-wrapper {
  padding: 12px !important; 
  margin: 0 !important;
}

.dashboard-container {
  max-width: 700px !important;   /* ‚ù§Ô∏è FINAL PERFECT NOTION WIDTH */
  margin: 0 auto !important;
}

/* ---------------------------------------------------
   HEADER
--------------------------------------------------- */

.dashboard-header {
  text-align: center;
  margin-bottom: 16px;
}

.dashboard-title {
  font-family: 'Cormorant Garamond', serif;
  font-size: 28px !important;
  margin: 0;
  color: #4A5F3D;
}

.dashboard-subtitle {
  font-size: 12px;
  opacity: 0.7;
  margin-top: 4px;
}

/* ---------------------------------------------------
   STATS GRID
--------------------------------------------------- */

.stats-grid {
  display: grid;
  grid-template-columns: 1fr;   /* ‚ù§Ô∏è ALWAYS ONE COLUMN */
  gap: 10px;
}

.stat-card {
  background: #ffffffee;
  border-radius: 16px;
  padding: 14px;
  border: 1px solid rgba(107,130,89,0.25);
  box-shadow: 0 4px 10px rgba(74,95,61,0.08);
}

.stat-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 6px;
}

.stat-label {
  font-size: 10px;
  letter-spacing: 1.4px;
  color: rgba(74,95,61,0.65);
  text-transform: uppercase;
}

.stat-value {
  font-size: 24px;
  font-weight: 600;
  color: #4A5F3D;
}

/* ---------------------------------------------------
   PROGRESS RINGS
--------------------------------------------------- */

.progress-card {
  background: #ffffffee;
  border-radius: 16px;
  padding: 16px;
  margin-top: 12px;
  border: 1px solid rgba(107,130,89,0.25);
}

.progress-card h3 {
  text-align: center;
  font-size: 12px;
  letter-spacing: 1.6px;
  margin-bottom: 12px;
}

.progress-rings {
  display: flex;
  flex-direction: column;   /* ‚ù§Ô∏è ALWAYS STACKED */
  align-items: center;
  gap: 16px;
}

.ring-wrapper {
  width: 80px !important;
  height: 80px !important;
  position: relative;
}

.progress-ring {
  width: 100%;
  height: 100%;
  transform: rotate(-90deg);
}

.progress-ring-circle {
  fill: none;
  stroke-width: 6 !important;
  transition: stroke-dashoffset 0.4s ease;
}

.progress-ring-bg {
  stroke: rgba(107,130,89,0.15);
}

.progress-ring-fill {
  stroke: #6B8259;
  stroke-linecap: round;
}

.ring-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.ring-value {
  font-size: 18px;
  font-weight: 600;
  color: #4A5F3D;
}

.ring-sublabel {
  font-size: 10px;
  opacity: 0.6;
  margin-top: 4px;
  text-align: center;
}

/* ---------------------------------------------------
   CONTENT GRID ‚Äî ONE COLUMN ONLY
--------------------------------------------------- */

.content-grid {
  display: grid;
  grid-template-columns: 1fr !important;   /* ‚ù§Ô∏è FIXED ONE COLUMN */
  gap: 12px;
  margin-top: 16px;
}

.content-card {
  background: #ffffffee;
  border-radius: 16px;
  padding: 16px;
  border: 1px solid rgba(107,130,89,0.25);
}

.card-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid rgba(107,130,89,0.15);
}

.card-title {
  font-size: 11px;
  letter-spacing: 1.6px;
  text-transform: uppercase;
  color: #4A5F3D;
  margin: 0;
}

.add-btn {
  width: 26px;
  height: 26px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  background: linear-gradient(135deg, #6B8259, #5D7150);
  color: white;
  font-size: 16px;
}

/* ---------------------------------------------------
   TASK LIST
--------------------------------------------------- */

.task-list {
  display: flex;
  flex-direction: column;
  gap: 6px;
  max-height: 180px !important;
  overflow-y: auto;
}

.task-item {
  display: flex;
  gap: 10px;
  padding: 10px;
  background: #ffffffdd;
  border-radius: 10px;
  border: 1px solid rgba(107,130,89,0.15);
  cursor: pointer;
}

.checkbox {
  width: 16px;
  height: 16px;
  border: 2px solid rgba(107,130,89,0.4);
  border-radius: 4px;
}

.checkbox.checked {
  background: #6B8259;
  border-color: #6B8259;
  position: relative;
}

.checkbox.checked::after {
  content: "";
  position: absolute;
  width: 3px;
  height: 7px;
  border: solid white;
  border-width: 0 2px 2px 0;
  left: 5px;
  top: 2px;
  transform: rotate(45deg);
}

.task-text {
  font-size: 13px;
  color: #4A5F3D;
}

.task-item.completed .task-text {
  opacity: 0.5;
  text-decoration: line-through;
}

.delete-btn {
  border: none;
  background: none;
  color: rgba(107,130,89,0.35);
  font-size: 16px;
  cursor: pointer;
  margin-left: auto;
}

/* ---------------------------------------------------
   INSIGHTS
--------------------------------------------------- */

.insights-card {
  background: #ffffffee;
  margin-top: 12px;
  padding: 16px;
  border-radius: 16px;
  border: 1px solid rgba(107,130,89,0.25);
}

.insight-item {
  display: flex;
  gap: 6px;
  margin-bottom: 8px;
}

/* ---------------------------------------------------
   MODAL
--------------------------------------------------- */

.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(26,22,19,0.6);
  display: none;
  align-items: center;
  justify-content: center;
}

.modal-overlay.active {
  display: flex;
}

.modal {
  background: #fff;
  padding: 20px;
  border-radius: 14px;
  width: 90%;
  max-width: 360px;
}

.modal input {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid rgba(107,130,89,0.4);
  margin-top: 6px;
}

.modal-buttons {
  display: flex;
  gap: 10px;
  margin-top: 14px;
}

.modal-btn {
  flex: 1;
  padding: 10px;
  border-radius: 20px;
  border: none;
  cursor: pointer;
  font-size: 12px;
  font-weight: 600;
}

.modal-btn.primary {
  background: #6B8259;
  color: white;
}

.modal-btn.secondary {
  background: rgba(107,130,89,0.15);
  color: #4A5F3D;
}

</style>
</head>

<body>

<div class="dashboard-wrapper">
  <div class="dashboard-container">

    <header class="dashboard-header">
      <h1 class="dashboard-title">Meal Prep Dashboard</h1>
      <p class="dashboard-subtitle">Track what's ready and what needs prepping</p>
    </header>

    <!-- ----------------- STATS ----------------- -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-header">
          <span class="stat-label">Prep Tasks</span>
          <span>üë©‚Äçüç≥</span>
        </div>
        <div class="stat-value" id="prepTasksCount">0</div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <span class="stat-label">Prepped Meals</span>
          <span>üç±</span>
        </div>
        <div class="stat-value" id="preppedCount">0</div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <span class="stat-label">Leftovers</span>
          <span>ü•°</span>
        </div>
        <div class="stat-value" id="leftoversCount">0</div>
      </div>
    </div>

    <!-- ----------------- RINGS ----------------- -->
    <div class="progress-card">
      <h3>Your Prep Status</h3>

      <div class="progress-rings">

        <div class="progress-ring-container">
          <div class="ring-wrapper">
            <svg class="progress-ring">
              <circle class="progress-ring-circle progress-ring-bg" cx="40" cy="40" r="34" />
              <circle id="prepRing" class="progress-ring-circle progress-ring-fill"
                cx="40" cy="40" r="34"
                stroke-dasharray="213" stroke-dashoffset="213" />
            </svg>
            <div class="ring-center">
              <div class="ring-value" id="prepValue">0</div>
            </div>
          </div>
          <div class="ring-sublabel" id="prepPercent">0% done</div>
        </div>

        <div class="progress-ring-container">
          <div class="ring-wrapper">
            <svg class="progress-ring">
              <circle class="progress-ring-circle progress-ring-bg" cx="40" cy="40" r="34" />
              <circle id="preppedRing" class="progress-ring-circle progress-ring-fill"
                style="stroke:#7A9468;"
                cx="40" cy="40" r="34"
                stroke-dasharray="213" stroke-dashoffset="213" />
            </svg>
            <div class="ring-center">
              <div class="ring-value" id="preppedValue">0</div>
            </div>
          </div>
          <div class="ring-sublabel" id="preppedPercent">0 ready</div>
        </div>

        <div class="progress-ring-container">
          <div class="ring-wrapper">
            <svg class="progress-ring">
              <circle class="progress-ring-circle progress-ring-bg" cx="40" cy="40" r="34" />
              <circle id="leftoversRing" class="progress-ring-circle progress-ring-fill"
                style="stroke:#A5B794;"
                cx="40" cy="40" r="34"
                stroke-dasharray="213" stroke-dashoffset="213" />
            </svg>
            <div class="ring-center">
              <div class="ring-value" id="leftoversValue">0</div>
            </div>
          </div>
          <div class="ring-sublabel" id="leftoversPercent">0 available</div>
        </div>

      </div>
    </div>

    <!-- ----------------- MAIN CONTENT ----------------- -->
    <div class="content-grid">

      <div class="content-card">
        <div class="card-header">
          <h3 class="card-title">Prep Tasks</h3>
          <button class="add-btn" id="addPrepBtn">+</button>
        </div>
        <div class="task-list" id="prepList">
          <div class="empty-state">Add prep tasks...</div>
        </div>
      </div>

      <div class="content-card">
        <div class="card-header">
          <h3 class="card-title">Prepped Meals</h3>
          <button class="add-btn" id="addPreppedBtn">+</button>
        </div>
        <div class="task-list" id="preppedList">
          <div class="empty-state">Add prepped meals...</div>
        </div>
      </div>

      <div class="content-card">
        <div class="card-header">
          <h3 class="card-title">Leftovers</h3>
          <button class="add-btn" id="addLeftoversBtn">+</button>
        </div>
        <div class="task-list" id="leftoversList">
          <div class="empty-state">Add leftovers...</div>
        </div>
      </div>

    </div>

    <!-- ----------------- INSIGHTS ----------------- -->
    <div class="insights-card">
      <h3>üí° Quick Overview</h3>
      <div id="insightsContainer">
        <div class="insight-item">
          <span>üéØ</span>
          <span>Start adding items to see insights!</span>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- ----------------- MODAL ----------------- -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <h3 id="modalTitle">Add Item</h3>

    <label>Item Name</label>
    <input id="taskInput" type="text" placeholder="Enter item..." />

    <div id="portionsSection" style="display:none;">
      <label>Portions</label>
      <input id="portionsInput" type="text" placeholder="e.g., 3 portions" />
    </div>

    <div id="dateSection" style="display:none;">
      <label>Date Cooked</label>
      <input id="dateInput" type="date" />
    </div>

    <div class="modal-buttons">
      <button class="modal-btn secondary" id="cancelBtn">Cancel</button>
      <button class="modal-btn primary" id="saveBtn">Add</button>
    </div>
  </div>
</div>

<script>
/* ---------------------------------------------------
   STORAGE
--------------------------------------------------- */

const STORAGE_KEY = "meal_prep_widget_v3";
let currentTasks = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");

/* ---------------------------------------------------
   HELPERS
--------------------------------------------------- */

function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(currentTasks));
}

function updateEverything() {
  updateStats();
  updateRings();
  updateLists();
  updateInsights();
}

/* ---------------------------------------------------
   STATS
--------------------------------------------------- */

function updateStats() {
  const prep = currentTasks.filter(t => t.category==="prep" && !t.completed).length;
  const prepped = currentTasks.filter(t => t.category==="prepped" && !t.completed).length;
  const leftovers = currentTasks.filter(t => t.category==="leftovers" && !t.completed).length;

  document.getElementById("prepTasksCount").textContent = prep;
  document.getElementById("preppedCount").textContent = prepped;
  document.getElementById("leftoversCount").textContent = leftovers;
}

/* ---------------------------------------------------
   RINGS
--------------------------------------------------- */

function updateRings() {
  const circ = 213;

  const prepTotal = currentTasks.filter(t=>t.category==="prep").length;
  const prepDone = currentTasks.filter(t=>t.category==="prep" && t.completed).length;
  const prepPct = prepTotal ? Math.round((prepDone / prepTotal)*100) : 0;

  document.getElementById("prepRing").style.strokeDashoffset = circ - circ*(prepPct/100);
  document.getElementById("prepValue").textContent = prepDone;
  document.getElementById("prepPercent").textContent = prepPct + "% done";

  const prepped = currentTasks.filter(t=>t.category==="prepped" && !t.completed).length;
  document.getElementById("preppedRing").style.strokeDashoffset = prepped>0 ? 0 : circ;
  document.getElementById("preppedValue").textContent = prepped;

  const leftovers = currentTasks.filter(t=>t.category==="leftovers" && !t.completed).length;
  document.getElementById("leftoversRing").style.strokeDashoffset = leftovers>0 ? 0 : circ;
  document.getElementById("leftoversValue").textContent = leftovers;
}

/* ---------------------------------------------------
   LISTS
--------------------------------------------------- */

function updateLists() {
  const groups = {
    prep: "prepList",
    prepped: "preppedList",
    leftovers: "leftoversList"
  };

  for (let cat in groups) {
    const el = document.getElementById(groups[cat]);
    const items = currentTasks.filter(t=>t.category===cat);

    if (items.length === 0) {
      el.innerHTML = `<div class="empty-state">No items yet...</div>`;
      continue;
    }

    el.innerHTML = "";
    items.forEach(task => {
      el.appendChild(createTaskEl(task));
    });
  }
}

function createTaskEl(task) {
  const div = document.createElement("div");
  div.className = "task-item";
  if (task.completed) div.classList.add("completed");

  const box = document.createElement("div");
  box.className = "checkbox";
  if (task.completed) box.classList.add("checked");

  const text = document.createElement("div");
  text.className = "task-text";
  text.textContent = task.text;

  box.addEventListener("click", e=>{
    e.stopPropagation();
    task.completed = !task.completed;
    save();
    updateEverything();
  });

  const del = document.createElement("button");
  del.className = "delete-btn";
  del.textContent = "√ó";
  del.addEventListener("click", e=>{
    e.stopPropagation();
    currentTasks = currentTasks.filter(t=>t.id!==task.id);
    save();
    updateEverything();
  });

  div.appendChild(box);
  div.appendChild(text);
  div.appendChild(del);

  return div;
}

/* ---------------------------------------------------
   INSIGHTS
--------------------------------------------------- */

function updateInsights() {
  const el = document.getElementById("insightsContainer");

  if (currentTasks.length === 0) {
    el.innerHTML = `
      <div class="insight-item"><span>üéØ</span><span>Start adding items!</span></div>
    `;
    return;
  }

  let out = "";

  const prepLeft = currentTasks.filter(t=>t.category==="prep" && !t.completed).length;
  if (prepLeft > 0) {
    out += `<div class="insight-item"><span>üìã</span><span>${prepLeft} prep tasks left</span></div>`;
  }

  const ready = currentTasks.filter(t=>t.category!=="prep" && !t.completed).length;
  if (ready > 0) {
    out += `<div class="insight-item"><span>‚ú®</span><span>${ready} meals ready</span></div>`;
  }

  el.innerHTML = out || `<div class="insight-item"><span>üëç</span><span>All caught up!</span></div>`;
}

/* ---------------------------------------------------
   MODAL
--------------------------------------------------- */

let currentCategory = "";

function openModal(cat) {
  currentCategory = cat;

  document.getElementById("modalTitle").textContent =
    cat==="prep" ? "Add Prep Task" :
    cat==="prepped" ? "Add Prepped Meal" :
    "Add Leftover";

  document.getElementById("taskInput").value = "";

  const portionSec = document.getElementById("portionsSection");
  const dateSec = document.getElementById("dateSection");

  if (cat==="prep") {
    portionSec.style.display = "none";
    dateSec.style.display = "none";
  } else {
    portionSec.style.display = "block";
    dateSec.style.display = "block";
  }

  document.getElementById("modalOverlay").classList.add("active");
}

document.getElementById("cancelBtn").addEventListener("click", ()=> {
  document.getElementById("modalOverlay").classList.remove("active");
});

document.getElementById("saveBtn").addEventListener("click", saveTask);

function saveTask() {
  const text = document.getElementById("taskInput").value.trim();
  if (!text) return;

  const portions = document.getElementById("portionsInput").value.trim();
  const date = document.getElementById("dateInput").value;

  currentTasks.push({
    id: Date.now(),
    text,
    category: currentCategory,
    completed: false,
    portions,
    cookedDate: date
  });

  save();
  updateEverything();
  document.getElementById("modalOverlay").classList.remove("active");
}

/* ---------------------------------------------------
   INIT
--------------------------------------------------- */

document.getElementById("addPrepBtn").onclick = () => openModal("prep");
document.getElementById("addPreppedBtn").onclick = () => openModal("prepped");
document.getElementById("addLeftoversBtn").onclick = () => openModal("leftovers");

updateEverything();

</script>

</body>
</html>
